<!DOCTYPE html>
<html>
<head>
  <title>Click Photo and Save or Send</title>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    emailjs.init("Mr3q_fySilH0V2PqC"); // Replace with your actual public key
  </script>
</head>
<body>

  <h2>üì∏ Click a Photo</h2>

  <!-- Webcam video stream -->
  <video id="video" width="300" height="200" autoplay></video><br><br>

  <!-- Button to capture -->
  <button onclick="startCamera()">üì∑ Start Camera</button>
  <button onclick="takePhoto()">üì∏ Take Photo</button>


  <!-- Save or Gmail buttons -->
  <button onclick="savePhoto()">üíæ Save It</button>
  <button onclick="sendPhoto()">üìß Gmail It</button><br><br>

  <!-- Canvas (hidden) for capturing -->
  <canvas id="canvas" width="300" height="200" style="display:none;"></canvas>

  <!-- Show captured image -->
  <img id="capturedImage" src="" alt="Captured Photo" style="display:none; border:1px solid #ccc; width:300px; height:200px;"><br><br>

  <!-- Hidden Email Form -->
  <form id="emailForm" method="POST">
    <input type="hidden" name="to_email" value="receiver@gmail.com"> <!-- Change to receiver's email -->
    <input type="hidden" name="image" id="photoData">
  </form>

  <script>
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const photoInput = document.getElementById("photoData");
    const capturedImage = document.getElementById("capturedImage");

    // Start webcam
    let stream = null;

    function startCamera() {
        navigator.mediaDevices.getUserMedia({ video: true })
        .then(s => {
        stream = s;
        video.srcObject = stream;
      })
        .catch(error => {
        alert("‚ùå Failed to access webcam");
        console.error(error);
      });
   }
    // Take photo
    function takePhoto() {
      const context = canvas.getContext("2d");
      context.drawImage(video, 0, 0, canvas.width, canvas.height);
      const image = canvas.toDataURL("image/jpeg", 0.3);  // lower quality = smaller size

      photoInput.value = image;
      capturedImage.src = image;
      capturedImage.style.display = "block";
      alert("‚úÖ Photo captured! Now click 'Save' or 'Gmail'");
    }

    // Save photo
    function savePhoto() {
      if (!photoInput.value) return alert("‚ùó Click a photo first");

      const link = document.createElement("a");
      link.href = photoInput.value;
      link.download = "photo.png";
      link.click();
    }

    // Submit form on button click
    function sendPhoto() {
      if (!photoInput.value) return alert("‚ùó Click a photo first");

      document.getElementById("emailForm").requestSubmit();
    }

    // EmailJS sendForm logic
    document.getElementById('emailForm').addEventListener('submit', function(e) {
      e.preventDefault();

      emailjs.sendForm('service_h9bg6oj', 'template_z4ose5h', this)
        .then(function() {
          alert("‚úÖ Email sent successfully!");
        }, function(error) {
          alert("‚ùå Failed to send email: " + JSON.stringify(error));
          console.error("Full error details:", error);
        });
    });
  </script>

</body>
</html>
